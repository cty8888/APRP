基于对需求文档的分析和当前代码库的检查，我来为每个阶段创建详细的任务清单：

## 后端需求分析 - 五个阶段详细任务清单

### 当前状态分析
- 已有基础 FastAPI 框架
- 已配置 SQLite + SQLAlchemy
- 已有文件上传功能（docx 解析）
- 缺少用户系统、数据库模型、认证等核心功能

---

## 阶段一：数据库与用户系统

### 1.1 数据库建模
**需要创建的表：**
- `users` 表：用户表（id, name, password_hash, role[teacher/student]）
- `classes` 表：班级表（id, name, teacher_id）
- `assignments` 表：任务表（id, title, description, class_id）
- `student_classes` 表：学生-班级关系表（id, student_id, class_id）
- `submissions` 表：提交表（id, student_id, assignment_id, file_json, report, score）

**具体任务：**
1. 创建 `app/models/` 目录下的模型文件
2. 定义 User 模型（SQLAlchemy）
3. 定义 Class 模型（SQLAlchemy）
4. 定义 Assignment 模型（SQLAlchemy）
5. 定义 StudentClass 模型（SQLAlchemy）
6. 定义 Submission 模型（SQLAlchemy）
7. 创建数据库迁移脚本（Alembic）
8. 运行迁移创建表结构

### 1.2 用户注册功能
**具体任务：**
1. 创建用户注册的 Pydantic 模式（schemas）
2. 实现密码加密功能（bcrypt）
3. 创建用户注册 API 端点
4. 添加输入验证和错误处理
5. 测试用户注册功能

### 1.3 用户登录功能
**具体任务：**
1. 创建用户登录的 Pydantic 模式
2. 实现 JWT token 生成和验证
3. 创建用户登录 API 端点
4. 实现密码验证逻辑
5. 添加认证中间件/依赖
6. 测试用户登录功能

---

## 阶段二：班级管理

### 2.1 教师创建班级
**具体任务：**
1. 创建班级相关的 Pydantic 模式
2. 实现教师创建班级 API 端点
3. 添加教师权限验证
4. 实现班级名称唯一性检查
5. 测试班级创建功能

### 2.2 学生加入班级
**具体任务：**
1. 创建学生加入班级的 API 端点
2. 实现班级名称查找逻辑
3. 添加重复加入检查
4. 实现学生-班级关系创建
5. 测试学生加入班级功能

### 2.3 查看班级
**具体任务：**
1. 创建教师查看班级列表 API
2. 创建学生查看班级列表 API
3. 实现基于角色的数据过滤
4. 添加班级信息格式化
5. 测试班级查看功能

---

## 阶段三：任务管理

### 3.1 教师创建任务
**具体任务：**
1. 创建任务相关的 Pydantic 模式
2. 实现教师创建任务 API 端点
3. 添加教师权限和班级所有权验证
4. 实现任务信息存储
5. 测试任务创建功能

### 3.2 学生查看任务
**具体任务：**
1. 创建学生查看任务列表 API
2. 实现基于学生班级的任务查询
3. 添加任务信息格式化
4. 实现任务状态显示
5. 测试学生查看任务功能

---

## 阶段四：提交系统

### 4.1 学生提交文档
**具体任务：**
1. 创建提交相关的 Pydantic 模式
2. 实现学生提交文档 API 端点
3. 添加学生权限和任务访问验证
4. 实现文件 JSON 存储
5. 实现重复提交覆盖逻辑
6. 测试文档提交功能

### 4.2 教师查看任务提交
**具体任务：**
1. 创建教师查看提交列表 API
2. 实现基于任务 ID 的提交查询
3. 添加提交信息格式化
4. 实现提交状态统计
5. 测试教师查看提交功能

---

## 阶段五：批改与可见性

### 5.1 教师批改
**具体任务：**
1. 创建批改相关的 Pydantic 模式
2. 实现教师批改 API 端点
3. 添加教师权限验证
4. 实现分数和报告更新
5. 添加批改状态管理
6. 测试教师批改功能

### 5.2 学生查看报告与分数
**具体任务：**
1. 创建学生查看提交详情 API
2. 实现基于提交 ID 的权限验证
3. 实现批改状态判断逻辑
4. 添加条件性数据显示
5. 实现报告和分数展示
6. 测试学生查看功能

---

## 通用任务（贯穿所有阶段）

### 基础设施
1. 完善错误处理和异常管理
2. 添加 API 文档和注释
3. 实现统一的响应格式
4. 添加日志记录
5. 创建单元测试
6. 性能优化和数据库查询优化

### 安全相关
1. 实现 JWT token 刷新机制
2. 添加 API 访问频率限制
3. 实现输入数据验证和清理
4. 添加 SQL 注入防护
5. 实现敏感数据加密

这个任务清单涵盖了需求文档中的所有功能点，按照逻辑依赖关系进行了排序。每个阶段都有明确的具体任务，便于逐步实现和测试。


[1 tool called]

我已经完成了对后端需求文档的详细分析，并创建了五个阶段的完整任务清单。

## 总结

基于需求文档，我识别出了以下五个主要阶段：

1. **阶段一：数据库与用户系统** - 建立数据模型、用户注册登录
2. **阶段二：班级管理** - 教师创建班级、学生加入班级、查看班级
3. **阶段三：任务管理** - 教师创建任务、学生查看任务
4. **阶段四：提交系统** - 学生提交文档、教师查看提交
5. **阶段五：批改与可见性** - 教师批改、学生查看报告分数

每个阶段都包含了具体的实现任务，从数据库建模到API端点开发，再到权限验证和测试。这些任务按照逻辑依赖关系排序，确保可以逐步实现整个系统。

当前代码库已经有了基础的FastAPI框架和SQLite配置，但缺少核心的用户系统、数据模型和业务逻辑。需要从阶段一开始，逐步构建完整的后端系统。